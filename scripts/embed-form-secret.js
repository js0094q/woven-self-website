// scripts/embed-form-secret.js
// Generates public/_form_secret.js during build using process.env.FORM_SECRET.
// If FORM_SECRET is not set, writes an empty placeholder.
// This file is not committed (ensure public/_form_secret.js is in .gitignore).

const fs = require('fs');
const path = require('path');

const outDir = path.join(__dirname, '..', 'public');
const outFile = path.join(outDir, '_form_secret.js');

// Ensure public directory exists
if (!fs.existsSync(outDir)) {
  fs.mkdirSync(outDir, { recursive: true });
}

const secret = process.env.FORM_SECRET || '';

const contents = `// Auto-generated by scripts/embed-form-secret.js
// Do not commit this file (it should be listed in .gitignore).
window.FORM_SECRET = ${JSON.stringify(secret)};
`;

fs.writeFileSync(outFile, contents, { encoding: 'utf8' });
console.log('[embed-form-secret] Wrote', outFile);
