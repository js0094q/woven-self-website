<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Blog Post | The Woven Self</title>
  <meta name="description" content="Therapy-informed writing by Loren Galese, LPC in New Jersey." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://wovenself.com/blog" />

  <link rel="stylesheet" href="/styles.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Markdown parser (no build step) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body class="antialiased">
  <header class="sticky top-0 bg-[var(--color-background)]/80 backdrop-blur border-b border-[var(--color-border)] z-50">
    <div class="container mx-auto px-4 py-5 flex justify-between items-center">
      <a href="/" class="flex items-center gap-3">
        <span class="text-2xl font-serif font-bold text-[var(--color-primary)]">The Woven Self</span>
      </a>
      <nav class="hidden md:flex gap-6 items-center">
        <a href="/" class="hover:text-[var(--color-primary)]">Home</a>
        <a href="/author.html" class="hover:text-[var(--color-primary)]">Credentials</a>
        <a href="/blog.html" class="font-semibold text-[var(--color-primary)]">Blog</a>
        <a href="/#contact" class="hover:text-[var(--color-primary)]">Contact</a>
        <a href="https://care.headway.co/providers/loren-galese?utm_source=pem&utm_medium=direct_link&utm_campaign=187918"
           target="_blank" rel="noopener noreferrer"
           class="btn-primary px-5 py-2.5 rounded-full font-semibold shadow-sm">Book</a>
      </nav>
    </div>
  </header>

  <main class="py-14 sm:py-16">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-3xl">
      <a href="/blog.html" class="inline-flex items-center gap-2 text-sm underline underline-offset-4">
        <span aria-hidden="true">‚Üê</span> Back to Blog
      </a>

      <div class="mt-8 card bg-white/70 rounded-3xl p-7 sm:p-10">
        <div id="post-meta" class="mb-6"></div>
        <article id="post-content" class="prose"></article>
      </div>
    </div>
  </main>

  <footer class="bg-[var(--color-light-bg)] text-center py-8">
    <p>&copy; 2026 The Woven Self Therapeutic Services, LLC</p>
  </footer>

  <script>
    function getSlug() {
      const url = new URL(window.location.href);
      return url.searchParams.get('slug') || '';
    }

    function esc(s) {
      return String(s || '').replace(/[&<>"']/g, (c) => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
      }[c]));
    }

    async function loadPost() {
      const slug = getSlug();
      if (!slug) throw new Error('Missing slug');

      // Load metadata from posts.json so we can display title/date and set <title>
      const postsRes = await fetch('/blog/posts.json', { cache: 'no-store' });
      const posts = await postsRes.json();
      const meta = posts.find(p => p.slug === slug);

      // Fetch markdown content
      const mdRes = await fetch(`/blog/posts/${slug}.md`, { cache: 'no-store' });
      if (!mdRes.ok) throw new Error('Post not found');
      const md = await mdRes.text();

      const title = meta?.title || slug.replace(/-/g, ' ');
      const date = meta?.date || '';
      const excerpt = meta?.excerpt || '';

      document.title = `${title} | The Woven Self (NJ)`;

      // Basic meta description update for share snippets
      const descTag = document.querySelector('meta[name="description"]');
      if (descTag && excerpt) descTag.setAttribute('content', excerpt);

      // Render meta header
      document.getElementById('post-meta').innerHTML = `
        <h1 class="text-4xl sm:text-5xl font-serif font-bold">${esc(title)}</h1>
        ${date ? `<div class="mt-3 text-sm opacity-80">${esc(date)}</div>` : ``}
      `;

      // Render markdown
      const html = marked.parse(md, { mangle: false, headerIds: true });
      document.getElementById('post-content').innerHTML = html;

      // Update canonical to this post URL
      const canonical = document.querySelector('link[rel="canonical"]');
      if (canonical) canonical.setAttribute('href', `https://wovenself.com/blog/${slug}`);
    }

    loadPost().catch(() => {
      document.getElementById('post-meta').innerHTML = '<h1 class="text-3xl font-serif font-bold">Post not found</h1>';
      document.getElementById('post-content').innerHTML = '<p>Return to the <a href="/blog.html">blog</a>.</p>';
    });
  </script>
</body>
</html>
